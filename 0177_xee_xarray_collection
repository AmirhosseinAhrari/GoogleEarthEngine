# -*- coding: utf-8 -*-
"""GEE_0100_xarray.ipynb

Tutorial Code by Amirhossein Ahrari
YouTube: https://www.youtube.com/@amirhosseinahrarigee
Tutorial Video: Google Earth Engine Tutorial-182: Image Collection vs. Xarray

This code is part of a tutorial series on Earth Engine programming techniques
presented on the Amirhossein Ahrari YouTube channel. You are free to use and modify
this code for academic and non-academic purposes. Don't forget to subscribe to
the Amirhossein Ahrari channel and follow the videos to support the instructor


"""

!pip install --upgrade xee
!pip install -U geemap

import ee

ee.Authenticate()
ee.Initialize(
    project = 'ee-amirhosseinahrari',
    opt_url = 'https://earthengine-highvolume.googleapis.com'
)

import geemap

map = geemap.Map()
map

roi = map.draw_last_feature.geometry()
roi

era = (
    ee.ImageCollection("ECMWF/ERA5/DAILY")
    .filterDate('2019','2020')
)

era

import xarray as xr

ds = xr.open_dataset(
    era,
    engine = 'ee',
    crs = 'EPSG:4326',
    scale = 1,
    geometry = roi
)

ds = ds.sortby('time') * 1

ds

ds.mean_2m_air_temperature

temp = ds.mean_2m_air_temperature

temp.coords

temp.dims

temp.values

temp.time.values

temp.lon.values

temp.lat.values

temp.isel(time = 20)

temp.sel(time = '2019-07-10')

temp.sel(time = slice('2019-07-01','2019-09-01'))

temp.sel(time = (temp.time.dt.month == 8))

temp_cel = temp - 273.15

temp_cel

july = temp_cel.sel(time = (temp_cel.time.dt.month == 7))

july.plot(
    x = 'lon', y = 'lat', col = 'time', robust = True, col_wrap = 7
)
